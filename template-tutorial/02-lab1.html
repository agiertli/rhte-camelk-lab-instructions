<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Template Tutorial</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/template-tutorial/02-lab1.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/course-template">Template Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="template-tutorial" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="01-setup.html">1. Setup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#02-deploy.adoc">2. Lab 1 - Local Development</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/agiertli/rhte-camelk-lab-instructions/edit/master/documentation/modules/ROOT/pages/02-lab1.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_lab_1_local_development"><a class="anchor" href="#_lab_1_local_development"></a>Lab 1 - Local development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_intro"><a class="anchor" href="#_intro"></a>Intro</h3>
<div class="paragraph">
<p><code>camel-k</code> is a cloud native integration framework: - builds on top of
camel, quarkus and targets Cloud (kubernetes, OpenShift) as its target
runtime. - comes with <code>kamel</code> cli tool which enables developer to deploy
integration onto cloud. By default, <code>kamel</code> requires cloud access.</p>
</div>
<div class="paragraph">
<p><strong>But what if you are in early stages of development and you just want to
test your integration locally?</strong></p>
</div>
<div class="paragraph">
<p><strong>What if the components you want to integrate with, are not yet
available in the cloud platform?</strong></p>
</div>
<div class="paragraph">
<p>There are two options how to start developing camel-k integration
locally without depending on cloud access:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kamel local</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://camel.apache.org/camel-k/1.10.x/running/local.html" class="bare">https://camel.apache.org/camel-k/1.10.x/running/local.html</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>camel/jbang</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://camel.apache.org/manual/camel-jbang.html" class="bare">https://camel.apache.org/manual/camel-jbang.html</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_task"><a class="anchor" href="#_task"></a>Task</h3>
<div class="paragraph">
<p><strong>1. Test the <code>camel/jbang</code> cli tooling to understand how the local
development experience looks like:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>SKIP NEXT 2 STEPS IF USING DEVSPACES</p>
</li>
<li>
<p>Install JBang as per <a href="https://www.jbang.dev/download/" class="bare">https://www.jbang.dev/download/</a></p>
</li>
<li>
<p>Install <code>camel</code> cli as per
<a href="https://camel.apache.org/manual/camel-jbang.html" class="bare">https://camel.apache.org/manual/camel-jbang.html</a></p>
</li>
<li>
<p>Create a <code>ArtemisIntegration.java</code> camel Route using <code>camel</code> cli and
run it</p>
<div class="literalblock">
<div class="content">
<pre>$ camel init ArtemisIntegration.java

$ camel run ArtemisIntegration.java</pre>
</div>
</div>
</li>
<li>
<p>You should see similar output in the console log</p>
<div class="literalblock">
<div class="content">
<pre>2022-11-29 20:37:28.693  INFO 72000 --- [ - timer://java] ArtemisIntegration.java:14               : Hello Camel from java</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Throughout this lab, we will be developing a very <strong>simple integration
which will talk to an Artemis broker</strong>.</p>
</div>
<div class="paragraph">
<p>Inside your workspace IDE, there is already artemis container up and
running with following characteristics: - <code>AMQ_USER=admin</code> -
<code>AMQ_PASSWORD=password1!</code> - Access to the artemis pod with dev spaces is
done using <code>artemis-amqp-service</code>.</p>
</div>
<div class="paragraph">
<p><strong>2. Connect <code>ArtemisIntegration</code> to the local Artemis</strong></p>
</div>
<div class="paragraph">
<p>Next step is to alter our <code>ArtemisIntegration.java</code> to send generated
messages to our broker.</p>
</div>
<div class="paragraph">
<p>There are multiple options how to do this: - <code>camel-amqp</code> component -
<code>camel-jms</code> with <code>qpid</code> library on the classpath.</p>
</div>
<div class="paragraph">
<p>Trouble is, <code>camel-amqp</code> is not yet fully supported at the time of
writing this lab (12/2022) and <code>camel-jms</code> forces you to set up a
ConnectionFactory bean manually, via code.</p>
</div>
<div class="paragraph">
<p>While this is possible in camel-k, it doesn’t create the best possible
developer experience. Generally speaking, when working with (custom)
beans is something which your integration heavily relies on, it should
prompt you to re-think the design and decide, whether Camel on Quarkus
wouldn’t be more suitable option as it offers the <em>most</em> flexibility.
There is no <em>single</em> right answer, single ConnectionFactory bean
certainly doesn’t disqualify usage of camel-k, but it’s good to be aware
of all the options.</p>
</div>
<div class="paragraph">
<p>Instead of implementing our custom ConnectionFactory bean, we will be
using a <code>Kamelet</code>. Kamelets are additional layers of abstraction of
camel components. They are hiding the camel component complexity and
exposing strict interface to its consumers. Their consumption doesn’t
require deep camel knowledge - only the knowledge of the interface
exposed by the particular Kamelet. They are also built for cloud native
deployment, so the transition from locally running route using <code>camel</code>
to fully fledged <code>camel-k</code> integration will be straightforward.</p>
</div>
<div class="paragraph">
<p><strong>Finish the Lab 1 by following steps below:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Locate amqp compatible kamelet <code>$ camel catalog kamelet | grep amqp</code></p>
</li>
<li>
<p>Familiarize yourself with the <strong>AMQP Sink Kamelet</strong>
<code>$ camel doc jms-amqp-10-sink</code></p>
</li>
<li>
<p>Change the <code>ArtemisIntegration.java</code> as follows:</p>
<div class="ulist">
<ul>
<li>
<p>remove <code>;</code> after the <code>log</code> command and add another step in the route
using <code>to</code> DSL</p>
</li>
<li>
<p>Use following kamelet endpoint syntax:</p>
<div class="ulist">
<ul>
<li>
<p><code>kamelet:&lt;kamelet-name&gt;?kameletOption=kameletValue</code>. Use following
values:</p>
</li>
<li>
<p>destination type - <code>topic</code></p>
</li>
<li>
<p>destination name - <code>userN-dev</code> (replace <code>N</code> with appropriate number)</p>
</li>
<li>
<p>remoteURI - <code>amqp://artemis-amqp-service:5672</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Run the <code>ArtemisIntegration.java</code> again, you should see following in
the logs:</p>
<div class="literalblock">
<div class="content">
<pre>2022-11-29 21:11:47.678  INFO 74446 --- [ - timer://java] ArtemisIntegration.java:14               : Hello Camel from java
2022-11-29 21:11:48.088  INFO 74446 --- [p-service:5672]] org.apache.qpid.jms.JmsConnection        : Connection ID:53273bd1-8d00-4c64-8988-cecd79b82dd8:8 connected to server: amqp://artemis-amqp-service:5672</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h3>
<div class="ulist">
<ul>
<li>
<p><code>kamel local</code> or <code>camel</code> cli tools allow developers to work on the
integrations locally which can be useful in early stages of development.</p>
</li>
<li>
<p>If your integration depends on 3rd party services (be it AMQ Broker,
Kafka cluster, etc) you could mock those locally by using <code>podman</code> or
<code>docker</code>. Engineering is working to improve the local development
experience, especially the ``mocking'' part.</p>
</li>
<li>
<p><code>Kamelets</code> can be extremely useful if you want to hide complexity of
the underlying camel components and enable non-camel developers to
integrate with services easily.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
